{% extends 'base.html' %}
{% load static %}

{% block title %}Laporan & Analisis - Eprokesba{% endblock %}
{% block extra_css %}

{{ chart_labels|json_script:"chart-labels" }}
{{ chart_data|json_script:"chart-data" }}
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const labels = JSON.parse(document.getElementById("chart-labels").textContent);
    const data = JSON.parse(document.getElementById("chart-data").textContent);

    new Chart(document.getElementById("myChart"), {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: "Jumlah Produk per Penjual",
                data: data
            }]
        }
    });
</script>
{% endblock %}

{% block content %}
<header>
  <h1>Laporan & Analisis Transaksi</h1>
</header>

<section class="filter-section">
  <form>
    <label>Tanggal Awal:</label>
    <input type="date" id="start-date">
    <label>Tanggal Akhir:</label>
    <input type="date" id="end-date">
    <label>Status:</label>
    <select id="status">
      <option>Semua</option>
      <option>Selesai</option>
      <option>Pending</option>
      <option>Dibatalkan</option>
    </select>
    <button type="button" class="btn-green">Filter</button>
  </form>
</section>

<section class="summary">
  <div class="card"><h3>Total Transaksi</h3><p>{{ total_transaksi }}</p></div>
  <div class="card"><h3>Total Penjual Aktif</h3><p>{{ total_penjual }}</p></div>
  <div class="card"><h3>Total Pembeli</h3><p>{{ total_pembeli }}</p></div>
  <div class="card"><h3>Total Pendapatan</h3><p>Rp {{ total_pendapatan }}</p></div>
</section>


<section class="chart-section">
  <h2>Grafik Penjualan per Bulan</h2>
  <canvas id="salesChart" width="400" height="100"></canvas>
</section>

<section class="table-section">
  <h2>Detail Transaksi</h2>
  <table>
    <thead>
      <tr>
        <th>No</th>
        <th>ID Transaksi</th>
        <th>Pembeli</th>
        <th>Penjual</th>
        <th>Produk</th>
        <th>Total</th>
        <th>Status</th>
        <th>Tanggal</th>
      </tr>
    </thead>
<tbody>
  {% for t in transaksi_list %}
  <tr>
    <td>{{ forloop.counter }}</td>
    <td>{{ t.id }}</td>
    <td>{{ t.pembeli }}</td>
    <td>{{ t.penjual }}</td>
    <td>{{ t.produk }}</td>
    <td>Rp {{ t.total }}</td>
    <td>{{ t.status }}</td>
    <td>{{ t.tanggal }}</td>
  </tr>
  {% endfor %}
</tbody>

  </table>

  <div class="export-buttons">
    <button class="btn-green">ðŸ“¥ Ekspor ke PDF</button>
    <button class="btn-outline">ðŸ“¤ Ekspor ke CSV</button>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/laporan.js' %}"></script>
{% endblock %}